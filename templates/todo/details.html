{% extends "todo/base.html" %}
{% load recurse %}

{% block extra_menu_items %}
  {% if task.locale %}<li><a href="{% url todo.views.dashboard %}?locale={{task.locale.code}}">&larr; all {{task.locale}}</a></li>{% endif %}
  {% if task.project %}<li><a href="{% url todo.views.dashboard %}?project={{task.project.slug}}">&larr; all {{task.project}}</a></li>{% endif %}
  {% if task.batch %}<li><a href="{% url todo.views.dashboard %}?project={{task.project.slug}}&amp;batch={{task.batch.slug}}">&larr; all {{task.batch}}</a></li>{% endif %}
{% endblock %}

{% block view %}

  <div class="task {{task.get_status_display}}">
    <h3>
      {% ifequal task.get_status_display "resolved" %}
        <input type="checkbox" checked="checked" disabled="disabled"/>
      {% endifequal %}
      {{task}}
    </h3>
    {% if task.locale %}<a href="{% url todo.views.dashboard %}?locale={{task.locale.code}}" class="tag">{{task.locale}}</a>{% endif %}
    {% if task.project %}<a href="{% url todo.views.dashboard %}?project={{task.project.slug}}" class="tag">{{task.project}}</a>{% endif %}
    {% if task.batch %}<a href="{% url todo.views.dashboard %}?project={{task.project.slug}}&amp;batch={{task.batch.slug}}" class="tag">{{task.batch}}</a>{% endif %}
    
    {% with task.children.all as todos %}
    {% recurse_children %}
      {% for todo in todos %}
      
        <div class="todo {{todo.get_status_display}}">
          {% if todo.is_next and perms.todo.change_todo %}
            <form action="{% url todo.views.resolve todo.id %}" method="post">
              <input type="hidden" name="task_id" value="{{task.id}}"/>
              {% if not todo.is_review %}
                <input type="checkbox" onclick="this.form.submit()"/>
              {% else %}
                <input type="checkbox" name="success" onclick="this.form.submit()"/>
                <input type="checkbox" name="failure" onclick="this.form.submit()"/>
              {% endif %}
              <span>
                {% if todo.owner %}<em>{{todo.owner}}:</em>{% endif %}
                {{todo}}
              </span>
            </form>
          {% else %}
            {% ifequal todo.get_status_display "resolved" %}
              <input type="checkbox" disabled="disabled" checked="checked"/>
            {% else %}
              <input type="checkbox" disabled="disabled"/>
            {% endifequal %}
            <span>
              {% if todo.owner %}<em>{{todo.owner}}:</em>{% endif %}
              {{todo.summary}} {% ifequal todo.resolution 2 %}<strong>(failed)</strong>{% endifequal %}
            </span>
          {% endif %}
          {% recurse todo.children.all as todos %}
        </div>

      {% endfor %}
    {% endrecurse %}
    {% endwith %}
  </div>

{% endblock %}
