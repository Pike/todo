{% extends "base.html" %}
{% load recurse %}

{% block title_matter %}todo dashboard{% endblock %}
{% block head_matter %}
<style>
  body {
     margin: 2em 6em 6em;
  }
  p, form {
    margin: 0;
    padding: 0;
  }
  small {
    font-size: 80%;
    color: #666;
  }
  strong {
    font-weight: normal;
  }
  #menu {
    margin: 0 20px 6em;
    padding: 10px;
    font-size: small;
    font-style: italic;
    background-color: #eee;
  }
  .task, .todo {
    margin: 10px 20px;
  }
  .task {
    border: 1px solid #ccc;
    margin-bottom: 2em;
    padding: 10px;
  }
  .task > form > strong {
    font-size: 1.3em;
  }
  .details-link {
    font-size: .8em;
    margin-left: 25px;
  }
  .todo input {
    float: left;
  }
  .todo span {
    display: block;
    padding-left: 25px;
  }
  .todo.new {
    color: #999;
  }
  .todo.next {
    background-color: #ff9;
  }
  .todo.resolved {
    color: #999;
    text-decoration: line-through;
  }
  select {
    display: none;
  }
  div:hover > form > select {
    display: inline;
  }
</style>
{% endblock %}



{% block content %}
  <div id="menu">
    <a href="{% url todo.views.new %}">new task</a>
  </div>
  {% for task in tasks %}
  <div class="task">
    <form action="{% url todo.views.change task.id %}" method="post">
      <strong>{{task.summary}}</strong>
      {% comment %}
      <select name="status" onchange="this.form.submit()">
        {% for i, status_tuple in statuses.items %}
        <option value="{{ i }}"{% ifequal i task.status %} selected="selected"{% endifequal %}>{{ status_tuple.1 }}</option>
        {% endfor %}
      </select>
      {% endcomment %}
    </form>
    {% with task.children.get_active as todos %}
    {% recurse_children %}
      {% for todo in todos %}
        <div class="todo">
          <form action="{% url todo.views.change todo.id %}" method="post">
            <input type="checkbox" {% if todo.children.get_active %}disabled="disabled"{% endif %}/>
            <span>
              {% if todo.owner %}<em>{{todo.owner}}:</em>{% endif %}
              {{todo.summary}}
            </span>
          </form>
          {% recurse todo.children.get_active as todos %}
        </div>
      {% endfor %}
    {% endrecurse %}
    {% endwith %}
    <p class="details-link"><a href="{% url todo.views.details task.id %}">details &rarr;</a></p>
  </div>
  {% endfor %}
{% endblock %}
