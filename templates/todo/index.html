{% extends "base.html" %}
{% load recurse %}

{% block title_matter %}todo dashboard{% endblock %}
{% block head_matter %}
<style>
  body {
     margin: 2em 6em 6em;
  }
  p, form {
    margin: 0;
    padding: 0;
  }
  small {
    font-size: 80%;
    color: #666;
  }
  strong {
    font-weight: normal;
  }
  #menu {
    margin: 0 20px 6em;
    padding: 10px;
    font-size: small;
    font-style: italic;
    background-color: #eee;
  }
  .task, .todo {
    margin: 10px 20px;
  }
  .task {
    border: 1px solid #ccc;
    margin-bottom: 2em;
    padding: 10px;
  }
  .task strong {
    font-size: 1.3em;
  }
  .details-link {
    font-size: .8em;
    margin-left: 25px;
  }
  .todo input {
    float: left;
  }
  .todo span {
    display: block;
    padding-left: 25px;
  }
  .todo.new {
    color: #999;
  }
  .todo.next {
    background-color: #ff9;
  }
  .todo.resolved {
    color: #999;
    text-decoration: line-through;
  }
  
  .empty {
    margin: 10px 20px;
    padding: 10px;
  }
  .empty h2 {
    font-style: italic;
  }
    
</style>
{% endblock %}



{% block content %}
  <div id="menu">
    <a href="{% url todo.views.new %}">new task</a>
  </div>
  {% for task in tasks %}
  <div class="task">
    <strong>{{task.summary}}</strong>
    {% with task.children.get_active as todos %}
    {% recurse_children %}
      {% for todo in todos %}
        <div class="todo">
          <form action="{% url todo.views.change todo.id %}" method="post">
            <input type="checkbox" disabled="disabled"/>
            <span>
              {% if todo.owner %}<em>{{todo.owner}}:</em>{% endif %}
              {{todo.summary}}
            </span>
          </form>
          {% recurse todo.children.get_active as todos %}
        </div>
      {% endfor %}
    {% endrecurse %}
    {% endwith %}
    <p class="details-link"><a href="{% url todo.views.task task.id %}">details &rarr;</a></p>
  </div>
  {% empty %}
  <div class="empty">
    <h2>Good news!</h2>
    <p>There are no active tasks.</p>
  </div>
  {% endfor %}
{% endblock %}
